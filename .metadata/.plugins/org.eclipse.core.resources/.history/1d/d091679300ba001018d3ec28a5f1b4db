package dao;

import java.sql.*;
import java.util.ArrayList;
import model.TacGia;

public class TacGiaDAO implements DAOInterface<TacGia> {

    @Override
    public ArrayList<TacGia> selectAll() {
        ArrayList<TacGia> ketQua = new ArrayList<>();
        String sql = "SELECT * FROM tacgia";

        try (Connection con = JDBCUtil.getConnection();
             PreparedStatement st = con.prepareStatement(sql);
             ResultSet rs = st.executeQuery()) {

            while (rs.next()) {
                int maTG = rs.getInt("maTG");
                String hoVaTen = rs.getString("tenTG");
                Date ngaySinh = rs.getDate("ngaySinh");
                String tieuSu = rs.getString("tieuSu");

                TacGia tg = new TacGia(maTG, hoVaTen, ngaySinh, tieuSu);
                ketQua.add(tg);
            }

            System.out.println("Đã thực thi: " + sql);
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return ketQua;
    }

    @Override
    public TacGia selectById(TacGia t) {
        TacGia ketQua = null;
        String sql = "SELECT * FROM tacgia WHERE maTG = ?";

        try (Connection con = JDBCUtil.getConnection();
             PreparedStatement st = con.prepareStatement(sql)) {

            st.setInt(1, t.getMaTG());
            ResultSet rs = st.executeQuery();

            if (rs.next()) {
                int maTG = rs.getInt("maTG");
                String hoVaTen = rs.getString("tenTG");
                Date ngaySinh = rs.getDate("ngaySinh");
                String tieuSu = rs.getString("tieuSu");

                ketQua = new TacGia(maTG, hoVaTen, ngaySinh, tieuSu);
            }

        } catch (SQLException e) {
            e.printStackTrace();
        }

        return ketQua;
    }

    @Override
    public int insert(TacGia t) {
        int ketQua = 0;
        String sql = "INSERT INTO tacgia (hoVaTen, ngaySinh, tieuSu) VALUES (?, ?, ?)";

        try (Connection con = JDBCUtil.getConnection();
             PreparedStatement st = con.prepareStatement(sql)) {

            st.setString(1, t.getTenTG());
            st.setDate(2, t.getNgaySinh());
            st.setString(3, t.getTieuSu());

            ketQua = st.executeUpdate();
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return ketQua;
    }

    @Override
    public int insertAll(ArrayList<TacGia> arr) {
        int dem = 0;
        for (TacGia tg : arr) {
            dem += insert(tg);
        }
        return dem;
    }

    @Override
    public int delete(TacGia t) {
        int ketQua = 0;
        String sql = "DELETE FROM tacgia WHERE maTG = ?";

        try (Connection con = JDBCUtil.getConnection();
             PreparedStatement st = con.prepareStatement(sql)) {

            st.setInt(1, t.getMaTG());
            ketQua = st.executeUpdate();

        } catch (SQLException e) {
            e.printStackTrace();
        }

        return ketQua;
    }

    @Override
    public int deleteAll(ArrayList<TacGia> arr) {
        int dem = 0;
        for (TacGia tg : arr) {
            dem += delete(tg);
        }
        return dem;
    }

    @Override
    public int update(TacGia t) {
        int ketQua = 0;
        String sql = "UPDATE tacgia SET hoVaTen = ?, ngaySinh = ?, tieuSu = ? WHERE maTG = ?";

        try (Connection con = JDBCUtil.getConnection();
             PreparedStatement st = con.prepareStatement(sql)) {

            st.setString(1, t.getTenTG());
            st.setDate(2, t.getNgaySinh());
            st.setString(3, t.getTieuSu());
            st.setInt(4, t.getMaTG());

            ketQua = st.executeUpdate();
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return ketQua;
    }

    public static void main(String[] args) {
        TacGiaDAO dao = new TacGiaDAO();
    }
}
